dist: bionic
sudo: enabled
language: python
python:
  - "3.5"
env:
  global:
    - ROS2_WS_XACRO=~/ros2_ws_xacro
    - ROS2_WS_XACRO_SRC=${ROS2_WS_XACRO}/src

# command to install dependencies
install:
  - sudo apt update && sudo apt install curl
  - curl http://repo.ros2.org/repos.key | sudo apt-key add -
  - sudo sh -c 'echo "deb [arch=amd64,arm64] http://repo.ros2.org/ubuntu/main `lsb_release -cs` main" > /etc/apt/sources.list.d/ros2-latest.list'
  - export ROS_DISTRO=dashing
  - sudo apt update && sudo apt install -y python3-rosdep ros-$ROS_DISTRO-ros-base
  - sudo apt install python3-colcon-common-extensions
  - sudo apt install build-essential
  - source /opt/ros/$ROS_DISTRO/setup.bash
  - sudo rosdep init
  - rosdep update
  - sudo apt install python3-pip
  - sudo pip3 install argcomplete setuptools pytest pep257 flake8
  - sudo -H python3 -m pip install -U setuptools

before_script:
  # stop the build if there are Python syntax errors or undefined names
  - flake8 . --count --select=E901,E999,F821,F822,F823 --show-source --statistics
  # exit-zero treats all errors as warnings.  The GitHub editor is 127 chars wide
  - flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics

# command to run tests
script:
  - mkdir -p $ROS2_WS_XACRO
  - mkdir -p $ROS2_WS_XACRO_SRC
  - ln -s $TRAVIS_BUILD_DIR $ROS2_WS_XACRO_SRC
  - cd $ROS2_WS_XACRO
  - colcon build
  - colcon test

branches:
  only:
    - ros2

notifications:
  email: false
